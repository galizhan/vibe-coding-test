---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/dataset_generator/__init__.py
  - src/dataset_generator/__main__.py
  - src/dataset_generator/cli.py
  - src/dataset_generator/models/__init__.py
  - src/dataset_generator/models/evidence.py
  - src/dataset_generator/models/use_case.py
  - src/dataset_generator/models/policy.py
  - .env.example
autonomous: true

must_haves:
  truths:
    - "python -m dataset_generator --help prints usage information without errors"
    - "Pydantic models enforce uc_ prefix on UseCase IDs and pol_ prefix on Policy IDs"
    - "Evidence model requires input_file, line_start (>=1), line_end (>=line_start), and quote"
    - "Policy type is constrained to must, must_not, escalate, style, format"
  artifacts:
    - path: "pyproject.toml"
      provides: "Project metadata, dependencies, package configuration"
      contains: "dataset_generator"
    - path: "src/dataset_generator/__main__.py"
      provides: "Entry point for python -m dataset_generator"
      min_lines: 3
    - path: "src/dataset_generator/cli.py"
      provides: "Typer CLI app with generate subcommand skeleton"
      exports: ["app"]
    - path: "src/dataset_generator/models/evidence.py"
      provides: "Evidence Pydantic model with line number validation"
      contains: "class Evidence"
    - path: "src/dataset_generator/models/use_case.py"
      provides: "UseCase Pydantic model with uc_ prefix validation"
      contains: "class UseCase"
    - path: "src/dataset_generator/models/policy.py"
      provides: "Policy Pydantic model with pol_ prefix and type enum"
      contains: "class Policy"
  key_links:
    - from: "src/dataset_generator/__main__.py"
      to: "src/dataset_generator/cli.py"
      via: "import app and call it"
      pattern: "from .cli import app"
    - from: "src/dataset_generator/models/use_case.py"
      to: "src/dataset_generator/models/evidence.py"
      via: "imports Evidence for use_case.evidence field"
      pattern: "from .evidence import Evidence"
    - from: "src/dataset_generator/models/policy.py"
      to: "src/dataset_generator/models/evidence.py"
      via: "imports Evidence for policy.evidence field"
      pattern: "from .evidence import Evidence"
---

<objective>
Set up the Python project structure, install dependencies, define all Pydantic data contracts, and create the CLI skeleton so that `python -m dataset_generator --help` works and all data models are importable with full validation.

Purpose: Establish the foundation that all subsequent plans depend on -- project structure, data contracts with validation, and CLI entry point.
Output: Working Python package with Pydantic models and Typer CLI skeleton.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure with pyproject.toml and install dependencies</name>
  <files>
    pyproject.toml
    src/dataset_generator/__init__.py
    src/dataset_generator/__main__.py
    src/dataset_generator/models/__init__.py
    src/dataset_generator/extraction/__init__.py
    .env.example
  </files>
  <action>
    Create pyproject.toml with:
    - name: "dataset-generator"
    - requires-python: ">=3.10"
    - dependencies: pydantic>=2.0, openai>=1.0, typer[all]>=0.12, python-dotenv>=1.0, tenacity>=8.0
    - [project.scripts] or entry point so `python -m dataset_generator` works
    - Use src-layout: packages under src/dataset_generator/

    Create src/dataset_generator/__init__.py with version string (__version__ = "0.1.0").

    Create src/dataset_generator/__main__.py:
    ```python
    from .cli import app

    if __name__ == "__main__":
        app()
    ```

    Create empty __init__.py files for models/ and extraction/ subpackages.

    Create .env.example with:
    ```
    OPENAI_API_KEY=your-api-key-here
    ```

    Then run: `pip install -e ".[dev]"` (or just `pip install -e .`) to install the package in editable mode. Verify with `python -m dataset_generator --help`.

    IMPORTANT: Use Pydantic v2 syntax throughout (model_dump, model_dump_json, field_validator -- NOT .dict(), .json(), or validator).
  </action>
  <verify>
    Run: `pip install -e .` completes without errors.
    Run: `python -c "import dataset_generator; print(dataset_generator.__version__)"` prints "0.1.0".
  </verify>
  <done>Package installs in editable mode. __version__ is importable. Directory structure exists with all __init__.py files.</done>
</task>

<task type="auto">
  <name>Task 2: Define Pydantic data contracts and CLI skeleton</name>
  <files>
    src/dataset_generator/models/evidence.py
    src/dataset_generator/models/use_case.py
    src/dataset_generator/models/policy.py
    src/dataset_generator/models/__init__.py
    src/dataset_generator/cli.py
  </files>
  <action>
    Create src/dataset_generator/models/evidence.py:
    - class Evidence(BaseModel) with fields: input_file (str), line_start (int), line_end (int), quote (str)
    - field_validator on line_start: must be >= 1 (1-based indexing)
    - model_validator (mode='after'): line_end must be >= line_start
    - field_validator on quote: must not be empty string

    Create src/dataset_generator/models/use_case.py:
    - Import Evidence from .evidence
    - class UseCase(BaseModel) with fields: id (str), name (str), description (str), evidence (list[Evidence])
    - field_validator on id: must start with "uc_"
    - field_validator on evidence: must have at least 1 item
    - class UseCaseList(BaseModel) with field: use_cases (list[UseCase])

    Create src/dataset_generator/models/policy.py:
    - Import Evidence from .evidence
    - PolicyType = Literal["must", "must_not", "escalate", "style", "format"]
    - class Policy(BaseModel) with fields: id (str), name (str), description (str), type (PolicyType), evidence (list[Evidence])
    - field_validator on id: must start with "pol_"
    - field_validator on evidence: must have at least 1 item
    - class PolicyList(BaseModel) with field: policies (list[Policy])

    Update src/dataset_generator/models/__init__.py to re-export all models:
    ```python
    from .evidence import Evidence
    from .use_case import UseCase, UseCaseList
    from .policy import Policy, PolicyList
    ```

    Create src/dataset_generator/cli.py:
    - Import typer, Path
    - app = typer.Typer(help="Generate synthetic datasets from requirements documents")
    - @app.command("generate") with parameters:
      - input_file: Path = typer.Option(..., "--input", exists=True, file_okay=True, dir_okay=False, help="Input markdown file")
      - out: Path = typer.Option(Path("./out"), "--out", help="Output directory")
      - seed: int = typer.Option(None, "--seed", help="Random seed for reproducibility")
      - n_use_cases: int = typer.Option(5, "--n-use-cases", min=1, help="Minimum number of use cases to extract")
      - n_test_cases_per_uc: int = typer.Option(3, "--n-test-cases-per-uc", min=1, help="Test cases per use case")
      - n_examples_per_tc: int = typer.Option(1, "--n-examples-per-tc", min=1, help="Examples per test case")
      - model: str = typer.Option("gpt-4o-mini", "--model", help="OpenAI model name")
    - Body: check OPENAI_API_KEY env var (exit with error if not set), create output dir, print "Not yet implemented" placeholder
    - @app.command("validate") as a placeholder that prints "Not yet implemented"
    - Load dotenv at module level: `from dotenv import load_dotenv; load_dotenv()`

    NOTE on Typer parameter naming: use `input_file` as the Python variable name (not `input` which shadows the builtin). The CLI flag is still --input.
  </action>
  <verify>
    Run: `python -m dataset_generator --help` shows "generate" and "validate" commands.
    Run: `python -m dataset_generator generate --help` shows all options (--input, --out, --seed, --n-use-cases, --model, etc.).
    Run: `python -c "from dataset_generator.models import UseCase, Policy, Evidence; print('Models OK')"` prints "Models OK".
    Run: `python -c "
from dataset_generator.models import UseCase, Evidence
try:
    UseCase(id='bad_id', name='test', description='test', evidence=[Evidence(input_file='f', line_start=1, line_end=1, quote='q')])
    print('FAIL: should have rejected bad_id')
except Exception as e:
    print(f'OK: {e}')
"` prints OK with validation error about uc_ prefix.
    Run: `python -c "
from dataset_generator.models import Policy, Evidence
try:
    Policy(id='pol_1', name='test', description='test', type='invalid_type', evidence=[Evidence(input_file='f', line_start=1, line_end=1, quote='q')])
    print('FAIL: should have rejected invalid type')
except Exception as e:
    print(f'OK: {e}')
"` prints OK with validation error about type.
  </verify>
  <done>
    CLI shows help with generate and validate subcommands. All CLI parameters (--input, --out, --seed, --n-use-cases, --n-test-cases-per-uc, --n-examples-per-tc, --model) are documented. Pydantic models enforce: uc_ prefix on use case IDs, pol_ prefix on policy IDs, policy type in [must, must_not, escalate, style, format], evidence line_start >= 1, line_end >= line_start, non-empty quote, at least 1 evidence per use case/policy.
  </done>
</task>

</tasks>

<verification>
1. `pip install -e .` succeeds
2. `python -m dataset_generator --help` shows generate and validate commands
3. `python -m dataset_generator generate --help` shows all required CLI options
4. All Pydantic models importable and validators work (reject bad IDs, bad types, bad line numbers)
5. Project follows src-layout pattern
</verification>

<success_criteria>
- Package installs and is importable as dataset_generator
- CLI entry point works via python -m dataset_generator
- All data contracts defined with validators enforcing ID prefixes, policy types, evidence constraints
- CLI accepts all required parameters from requirements (--input, --out, --seed, --n-use-cases, --n-test-cases-per-uc, --n-examples-per-tc, --model)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
